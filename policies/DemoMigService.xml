<?xml version="1.0" encoding="UTF-8"?>
<wsp:Policy xmlns:L7p="http://www.layer7tech.com/ws/policy" xmlns:wsp="http://schemas.xmlsoap.org/ws/2002/12/policy">
    <wsp:All wsp:Usage="Required">
        <L7p:CustomizeErrorResponse>
            <L7p:Content stringValueReference="inline"><![CDATA[{
   "error":"Authentication Error"
}]]></L7p:Content>
            <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
            <L7p:ExtraHeaders nameValuePairArray="included"/>
            <L7p:HttpStatus stringValue="401"/>
        </L7p:CustomizeErrorResponse>
        <wsp:OneOrMore wsp:Usage="Required">
            <wsp:All wsp:Usage="Required">
                <L7p:Encapsulated>
                    <L7p:EncapsulatedAssertionConfigGuid stringValue="393bcb93-82ad-4b55-8333-1119f607a560"/>
                    <L7p:EncapsulatedAssertionConfigName stringValue="OTK Require OAuth 2.0 Token"/>
                    <L7p:Parameters mapValue="included">
                        <L7p:entry>
                            <L7p:key stringValue="any_resource_required"/>
                            <L7p:value stringValue="false"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="cache_lifetime"/>
                            <L7p:value stringValue="11234"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="custom"/>
                            <L7p:value stringValue="2134"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="disable_audience_check"/>
                            <L7p:value stringValue="false"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="given_access_token"/>
                            <L7p:value stringValue="1234"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="onetime"/>
                            <L7p:value stringValue="false"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="resource_required"/>
                            <L7p:value stringValue="1234"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="scope_fail"/>
                            <L7p:value stringValue="false"/>
                        </L7p:entry>
                        <L7p:entry>
                            <L7p:key stringValue="scope_required"/>
                            <L7p:value stringValue="4324555"/>
                        </L7p:entry>
                    </L7p:Parameters>
                </L7p:Encapsulated>
            </wsp:All>
            <L7p:Include>
                <L7p:PolicyGuid stringValue="0c8321c3-d484-4675-b1be-eddf6e780b8a"/>
                <L7p:PolicyName stringValue="DemoAuthFragment"/>
            </L7p:Include>
        </wsp:OneOrMore>
        <L7p:Include>
            <L7p:PolicyGuid stringValue="819980fa-58cd-4134-a8c3-80290bcf340f"/>
            <L7p:PolicyName stringValue="demoChangeFragment_loadConfig"/>
        </L7p:Include>
        <L7p:CustomizeErrorResponse>
            <L7p:Content stringValueReference="inline"><![CDATA[{
   "error":"Back-End Error"
}]]></L7p:Content>
            <L7p:ContentType stringValue="application/json; charset=UTF-8"/>
            <L7p:ExtraHeaders nameValuePairArray="included"/>
        </L7p:CustomizeErrorResponse>
        <L7p:Encapsulated>
            <L7p:EncapsulatedAssertionConfigGuid stringValue="14bb7541-8b93-4a6a-b294-bc8981f25cdd"/>
            <L7p:EncapsulatedAssertionConfigName stringValue="demo_returnRequestParameterAsJSON"/>
        </L7p:Encapsulated>
        <L7p:HttpRoutingAssertion>
            <L7p:KeyAlias stringValue="ssl"/>
            <L7p:NonDefaultKeystoreId goidValue="00000000000000000000000000000002"/>
            <L7p:ProtectedServiceUrl stringValue="https://${gateway.demo.backend.host}${gateway.demo.transformerPath}"/>
            <L7p:ProxyPassword stringValueNull="null"/>
            <L7p:ProxyUsername stringValueNull="null"/>
            <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                <L7p:ForwardAll booleanValue="true"/>
                <L7p:Rules httpPassthroughRules="included">
                    <L7p:item httpPassthroughRule="included">
                        <L7p:Name stringValue="Cookie"/>
                    </L7p:item>
                    <L7p:item httpPassthroughRule="included">
                        <L7p:Name stringValue="SOAPAction"/>
                    </L7p:item>
                </L7p:Rules>
            </L7p:RequestHeaderRules>
            <L7p:RequestParamRules httpPassthroughRuleSet="included">
                <L7p:ForwardAll booleanValue="true"/>
                <L7p:Rules httpPassthroughRules="included"/>
            </L7p:RequestParamRules>
            <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                <L7p:ForwardAll booleanValue="true"/>
                <L7p:Rules httpPassthroughRules="included">
                    <L7p:item httpPassthroughRule="included">
                        <L7p:Name stringValue="Set-Cookie"/>
                    </L7p:item>
                </L7p:Rules>
            </L7p:ResponseHeaderRules>
            <L7p:ResponseMsgDest stringValue="backendResponse"/>
            <L7p:SamlAssertionVersion intValue="2"/>
            <L7p:UsesDefaultKeyStore booleanValue="false"/>
        </L7p:HttpRoutingAssertion>
        <L7p:HttpRoutingAssertion>
            <L7p:Enabled booleanValue="false"/>
            <L7p:KeyAlias stringValue="ssl"/>
            <L7p:NonDefaultKeystoreId goidValue="00000000000000000000000000000002"/>
            <L7p:ProtectedServiceUrl stringValue="https://${servicehost.result}${serviceport.result}${serviceurl.result}"/>
            <L7p:ProxyPassword stringValueNull="null"/>
            <L7p:ProxyUsername stringValueNull="null"/>
            <L7p:RequestHeaderRules httpPassthroughRuleSet="included">
                <L7p:ForwardAll booleanValue="true"/>
                <L7p:Rules httpPassthroughRules="included">
                    <L7p:item httpPassthroughRule="included">
                        <L7p:Name stringValue="Cookie"/>
                    </L7p:item>
                    <L7p:item httpPassthroughRule="included">
                        <L7p:Name stringValue="SOAPAction"/>
                    </L7p:item>
                </L7p:Rules>
            </L7p:RequestHeaderRules>
            <L7p:RequestParamRules httpPassthroughRuleSet="included">
                <L7p:ForwardAll booleanValue="true"/>
                <L7p:Rules httpPassthroughRules="included"/>
            </L7p:RequestParamRules>
            <L7p:ResponseHeaderRules httpPassthroughRuleSet="included">
                <L7p:ForwardAll booleanValue="true"/>
                <L7p:Rules httpPassthroughRules="included">
                    <L7p:item httpPassthroughRule="included">
                        <L7p:Name stringValue="Set-Cookie"/>
                    </L7p:item>
                </L7p:Rules>
            </L7p:ResponseHeaderRules>
            <L7p:ResponseMsgDest stringValue="backendResponse"/>
            <L7p:SamlAssertionVersion intValue="2"/>
            <L7p:UsesDefaultKeyStore booleanValue="false"/>
        </L7p:HttpRoutingAssertion>
        <L7p:SetVariable>
            <L7p:Base64Expression stringValue="JHtnYXRld2F5LmRlbW8uc2V0dGluZ30="/>
            <L7p:VariableToSet stringValue="demoSetting"/>
        </L7p:SetVariable>
        <L7p:HardcodedResponse>
            <L7p:Base64ResponseBody stringValue="ewogICJyZXF1ZXN0UGFyYW1ldGVycyI6ICR7Y3JhZnRlZF9yZXNwb25zZX0sCiAgImN3cFNldHRpbmdTdGF0dXMiOiIke2RlbW9TZXR0aW5nfSIsCiAgJHtiYWNrZW5kUmVzcG9uc2UubWFpbnBhcnR9Cn0="/>
            <L7p:ResponseContentType stringValue="application/json; charset=UTF-8"/>
        </L7p:HardcodedResponse>
    </wsp:All>
</wsp:Policy>
